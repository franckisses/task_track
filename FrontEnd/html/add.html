<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="../static/js/jquery-3.6.1.min.js"></script>
    <style>
    #category {
        width: 40;
        height: 60;
        font-family: verdana;
        margin: 30px;
    }
    a {
        margin-right: 30px;
    }
   
    #my_login {
        float: right;
        margin-right: 10px;
        list-style:none
    }
    #title {
        list-style: none;
    }
    </style>
    <title>ADD Task</title>
</head>
<body>
    <ul>
        <li id="title"><h2>Task Add</h2></li>
        <li id ='my_login'><a href="login.html" >登录</a></li>
    </ul>
    <a id="category" class="all">ADD New Task Here</a>
    <hr>
    <p>Project Country:<input id="country" type="text"></p>
    <p>Customer Name:<input id="customer" type="text"></p>
    <p>Task Name:<input id="task-name" type="text"></p>
    <p>Task Desc:<input id="task-desc" type="text"></p>
    <p>Doc: <button onclick="addfile()">+</button></p>
    <ol class="files">
        <li><p class="each-file"><input id="desc-detail1" type="file" ></li>
    </ol>
    <button>submit</button>
</body>
<script>
    // 1. 检查如果没有登录的话，那么重定向去登录页面
    // 2. 如果登录的话，那么发送请求验证是否还在有效期呢。不在有效期的话，让重新登录
    var loginName = window.localStorage.getItem('username');
    if (loginName){
        $('#my_login').children().html(loginName).on('click',(e)=>{
            e.preventDefault()
            window.localStorage.clear();
            alert('退出登录')
            window.location.reload()
            $('#my_login').children().html('登录')
        })
    }
    function addfile(){
        files_num = $('.each-file').length
        ++ files_num
        $('ol').append( 
        `<li><p class="each-file"><input id="desc-detail`+ files_num +`" type="file" ><button onclick="remove(this)">-</button></p></li>`)
    }
    function remove(el) {
        var element = el;
        element.parentElement.parentElement.remove()
    }
    function submit(){
        project_country = $('#country').val()
        customer_name = $('#customer').val()
        task_name = $('task-name').val()
        task_desc = $('task-desc').val()
        desc_file = $('desc-deatil').files[0]
        data = {'username': username, 'password':password}
        if (username && password){
            $.ajax({
                type: 'POST',
                url: BASEURL + 'tokens',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (result){
                    console.log(result)
                    if (result.code==200){
                        confirm('登录成功!')
                        localStorage.setItem('username', result.username);
                        localStorage.setItem('token', result.data.token);
                        window.location.href='index.html'
                    } else {
                        alert(result.error)
                    }
                }

            })
        }
    }
</script>
</html>